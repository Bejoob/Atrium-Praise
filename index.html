<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Atrium Praise</title>
    <meta name="description" content="Visualização estática do repertório do ministério Atrium Praise" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
      html { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
      .font-display { font-family: 'Playfair Display', serif; }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 text-slate-900">
    <div id="root"></div>

    <!-- React 18 + ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel for in-browser JSX transform -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      // ========================= INSTRUÇÕES =========================
      // 1) Edite o array SONGS abaixo para gerenciar as músicas manualmente.
      // 2) Publique este arquivo diretamente (GitHub Pages, Vercel, Netlify).
      // 3) Este arquivo não usa backend. É somente leitura.

      const SONGS = [
        { id: '1', title: 'O Que Sua Glória Fez Comigo', link: 'https://www.youtube.com/watch?v=9fZph9kZkgM&list=RD9fZph9kZkgM&start_radio=1', key: 'C', tags: ['adoração'], chorus: 'Quem ja pisou no Santo dos Santos...', lastPlayedDate: '28/09/2025' },
        { id: '2', title: 'Digino de tudo', link: 'https://www.youtube.com/watch?v=cQlEODXxnu0&list=RDcQlEODXxnu0&start_radio=1', key: 'F', tags: ['louvor'], chorus: 'Os santos e os Anjos', lastPlayedDate: '28/09/2025' },
        { id: '3', title: 'Quem é esse', link: 'https://www.youtube.com/watch?v=0ZF5em0MTwY&list=RD0ZF5em0MTwY&start_radio=1', key: 'B', tags: ['adoração'], chorus: 'Quem é esse, que era sem pecado e não me condenou...', lastPlayedDate: '28/09/2025' },
        { id: '4', title: 'Maravilhosa Graça', link: 'https://www.youtube.com/watch?v=nv-T2_JPKZA&list=RDnv-T2_JPKZA&start_radio=1', key: 'D', tags: ['celebração'], chorus: 'Maravilhosa graça, seu infnito amor', lastPlayedDate: '' },
        { id: '5', title: 'Há Poder', link: 'https://www.youtube.com/watch?v=4WmlJFsxDv4', key: 'B', tags: ['adoração'], chorus: 'Há Poder no teu nome, Jesus, rei sobre o trono', lastPlayedDate: '' },
        { id: '6', title: 'Tu és Deus (A Ele)', link: 'https://www.youtube.com/watch?v=6YQNTOj-OLM', key: 'F', tags: ['adoração'], chorus: 'Tu és Deus (A Ele)', lastPlayedDate: '' }
      ];

      const PRAISE_SCHEDULE = [
        '12/10 — Tetê e Lea',
        '19/10 — Alessandra e Lea',
        '26/10 — Tetê e Eleonai',
        '02/11 — Alessandra e Eleonai',
        '09/11 — Tetê e Lea',
        '16/11 — Alessandra e Lea',
        '23/11 — Tetê e Eleonai',
        '30/11 — Alessandra e Eleona',
      ];

      function isYouTubeUrl(url) {
        try {
          const u = new URL(url);
          const host = u.hostname.replace(/^www\./, '');
          return host === 'youtube.com' || host === 'youtu.be' || host === 'm.youtube.com';
        } catch {
          return false;
        }
      }

      function extractYouTubeId(url) {
        try {
          const u = new URL(url);
          if (u.hostname.includes('youtu.be')) return u.pathname.slice(1);
          if (u.searchParams.get('v')) return u.searchParams.get('v');
          const match = u.pathname.match(/\/embed\/([\w-]{6,})/);
          if (match) return match[1];
          const generic = url.match(/(?:v=|\/)([\w-]{6,})(?:[&?].*)?$/);
          return generic ? generic[1] : '';
        } catch {
          return '';
        }
      }

      function toCsvValue(value) {
        const s = value ?? '';
        const escaped = String(s).replace(/"/g, '""');
        return `"${escaped}"`;
      }

      function downloadFile(filename, content, mime = 'text/plain;charset=utf-8') {
        const blob = new Blob([content], { type: mime });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function AtriumPraise_Static_Viewer() {
        const { useMemo, useState, useEffect, useCallback } = React;

        const [query, setQuery] = useState('');
        const [dateOrder, setDateOrder] = useState('none'); // 'none' | 'recent' | 'oldest'
        const [showHelp, setShowHelp] = useState(false);
        const [playerId, setPlayerId] = useState('');
        const [playerExternalUrl, setPlayerExternalUrl] = useState('');
        const [autoplay, setAutoplay] = useState(true);
        const [showSchedule, setShowSchedule] = useState(false);

        // Filtro por tom removido por solicitação

        const normalizedQuery = query.trim().toLowerCase();

        function parseLastPlayed(dateStr) {
          if (!dateStr) return null;
          const iso = /^\d{4}-\d{2}-\d{2}$/;
          const br = /^\d{2}\/\d{2}\/\d{4}$/;
          try {
            if (iso.test(dateStr)) {
              const d = new Date(dateStr);
              return isNaN(d.getTime()) ? null : d;
            }
            if (br.test(dateStr)) {
              const [dd, mm, yyyy] = dateStr.split('/');
              const d = new Date(Number(yyyy), Number(mm) - 1, Number(dd));
              return isNaN(d.getTime()) ? null : d;
            }
            const d = new Date(dateStr);
            return isNaN(d.getTime()) ? null : d;
          } catch { return null; }
        }

        const filteredSongs = useMemo(() => {
          const filtered = SONGS.filter(song => {
            if (!normalizedQuery) return true;
            const title = (song.title || '').toLowerCase();
            const tags = (song.tags || []).map(t => (t || '').toLowerCase());
            const inTitle = title.includes(normalizedQuery);
            const inTags = tags.some(t => t.includes(normalizedQuery));
            return (inTitle || inTags);
          });
          if (dateOrder === 'recent' || dateOrder === 'oldest') {
            const sortedByDate = [...filtered].sort((a, b) => {
              const da = parseLastPlayed(a.lastPlayedDate);
              const db = parseLastPlayed(b.lastPlayedDate);
              if (!da && !db) return (a.title || '').localeCompare(b.title || '', undefined, { sensitivity: 'base' });
              if (!da) return 1;
              if (!db) return -1;
              return dateOrder === 'recent' ? db - da : da - db;
            });
            return sortedByDate;
          }
          const sorted = [...filtered].sort((a, b) => (a.title || '').localeCompare(b.title || '', undefined, { sensitivity: 'base' }));
          return sorted;
        }, [normalizedQuery, dateOrder]);

        const exportCsv = useCallback((rows, filename) => {
          const headers = ['id', 'title', 'link', 'key', 'tags'];
          const headerLine = headers.map(h => toCsvValue(h)).join(',');
          const lines = rows.map(r => {
            const tagsJoined = (r.tags || []).join(' | ');
            return [toCsvValue(r.id), toCsvValue(r.title), toCsvValue(r.link), toCsvValue(r.key), toCsvValue(tagsJoined)].join(',');
          });
          const csv = ['\ufeff' + headerLine, ...lines].join('\n');
          downloadFile(filename, csv, 'text/csv;charset=utf-8');
        }, []);

        const onPlay = useCallback((song) => {
          if (isYouTubeUrl(song.link)) {
            const id = extractYouTubeId(song.link);
            if (id) { setPlayerId(id); setPlayerExternalUrl(song.link); }
          } else {
            window.open(song.link, '_blank', 'noopener,noreferrer');
          }
        }, []);

        const closeModal = useCallback(() => { setPlayerId(''); setPlayerExternalUrl(''); }, []);

        useEffect(() => {
          const onEsc = (e) => { if (e.key === 'Escape') closeModal(); };
          window.addEventListener('keydown', onEsc);
          return () => window.removeEventListener('keydown', onEsc);
        }, [closeModal]);

        return (
          <div className="min-h-screen">
            <header className="sticky top-0 z-10 backdrop-blur-sm bg-white/80 border-b border-slate-200 shadow-sm">
              <div className="mx-auto max-w-7xl px-4 py-4 flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="h-10 w-10 rounded-full bg-indigo-600 text-white grid place-items-center font-bold text-lg shadow-md">AP</div>
                  <div>
                    <h1 className="font-display text-2xl sm:text-3xl font-bold text-indigo-800">Atrium Praise</h1>
                    <p className="text-xs text-slate-500 mt-0.5">Repertório interativo</p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <button onClick={() => setShowHelp(true)} className="text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors">Instruções</button>
                  <button onClick={() => setShowSchedule(true)} className="text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors">Escala</button>
                </div>
              </div>
            </header>

            <section className="mx-auto max-w-7xl px-4 py-6 sm:py-8">
              <div className="grid grid-cols-1 sm:grid-cols-4 gap-4">
                <div className="sm:col-span-3">
                  <label htmlFor="search-input" className="block text-sm font-medium text-slate-700 mb-1">Buscar por título ou tags</label>
                  <div className="relative">
                    <input
                      id="search-input"
                      type="text"
                      value={query}
                      onChange={(e) => setQuery(e.target.value)}
                      placeholder="Ex.: adoração, Luz do Mundo"
                      className="w-full rounded-md border border-slate-300 bg-white px-4 py-2 pr-10 text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                    <span className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">⌕</span>
                  </div>
                </div>
                <div>
                  <label htmlFor="date-order-select" className="block text-sm font-medium text-slate-700 mb-1">Ordenação por data</label>
                  <select
                    id="date-order-select"
                    value={dateOrder}
                    onChange={(e) => setDateOrder(e.target.value)}
                    className="w-full rounded-md border border-slate-300 bg-white px-4 py-2 text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  >
                    <option value="none">Sem ordenação</option>
                    <option value="recent">Tocadas recentemente</option>
                    <option value="oldest">Mais antigas</option>
                  </select>
                </div>
              </div>

              <div className="mt-5 flex flex-wrap items-center gap-3">
                <button onClick={() => exportCsv(SONGS, 'atrium_praise_todas.csv')} className="text-sm px-4 py-2 rounded-md bg-indigo-500 text-white hover:bg-indigo-600 transition-colors shadow-sm">Exportar todas (.csv)</button>
                <button onClick={() => exportCsv(filteredSongs, 'atrium_praise_filtradas.csv')} className="text-sm px-4 py-2 rounded-md bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 transition-colors shadow-sm">Exportar filtradas (.csv)</button>
                <span className="ml-auto text-sm text-slate-600">Exibindo {filteredSongs.length} de {SONGS.length} músicas</span>
              </div>
            </section>

            <main className="mx-auto max-w-7xl px-4 pb-12">
              {filteredSongs.length === 0 ? (
                <div className="rounded-lg border border-dashed border-slate-300 bg-white p-8 text-center text-slate-500 shadow-sm">Nenhuma música encontrada com os critérios de busca.</div>
              ) : (
                <ul className="space-y-4">
                  {filteredSongs.map(song => (
                    <li key={song.id} className="group rounded-xl border border-slate-200 bg-white p-4 shadow-sm hover:shadow-md transition-all duration-200 ease-in-out">
                      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <div className="min-w-0 flex-1">
                          <h3 className="font-semibold text-slate-900 text-lg sm:text-xl truncate">{song.title}</h3>
                          {song.chorus && (
                            <p className="mt-1 text-sm text-slate-600 line-clamp-2">{song.chorus}</p>
                          )}
                          <div className="mt-2 flex flex-wrap items-center gap-2">
                            {song.key && (
                              <span className="text-xs inline-flex items-center rounded-full bg-indigo-100 text-indigo-800 px-2.5 py-0.5 font-medium">Tom: {song.key}</span>
                            )}
                            {(song.tags || []).map(tag => (
                              <span key={tag} className="text-xs inline-flex items-center rounded-full bg-slate-100 text-slate-700 px-2.5 py-0.5 font-medium border border-slate-200">{tag}</span>
                            ))}
                            {song.lastPlayedDate && (
                              <span className="text-xs text-slate-500 ml-auto sm:ml-0">Última vez: <span className="font-medium">{song.lastPlayedDate}</span></span>
                            )}
                          </div>
                          {/* Link ocultado por solicitação */}
                        </div>
                        <div className="flex-shrink-0">
                          <button onClick={() => onPlay(song)} className="px-5 py-2 rounded-lg bg-indigo-600 text-white text-base font-medium hover:bg-indigo-700 transition-colors shadow-md">Play</button>
                        </div>
                      </div>
                    </li>
                  ))}
                </ul>
              )}
            </main>

            {playerId && (
              <div className="fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                <div className="absolute inset-0 bg-black/70" onClick={() => setPlayerId('')} />
                <div className="relative z-10 w-full max-w-4xl rounded-xl bg-white shadow-2xl overflow-hidden">
                  <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200 bg-slate-50">
                    <div className="flex items-center gap-4">
                      <span className="text-base font-semibold text-slate-800">Reproduzindo música</span>
                      <label className="flex items-center gap-1.5 text-sm text-slate-600 cursor-pointer">
                        <input type="checkbox" checked={autoplay} onChange={(e) => setAutoplay(e.target.checked)} className="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500" /> Autoplay
                      </label>
                    </div>
                    <div className="flex items-center gap-3">
                      {playerExternalUrl && (
                        <a href={playerExternalUrl} target="_blank" rel="noreferrer noopener" className="text-sm px-3 py-1.5 rounded-md border border-slate-300 bg-white text-slate-700 hover:bg-slate-100 transition-colors">Abrir no YouTube</a>
                      )}
                      <button onClick={() => setPlayerId('')} className="text-slate-500 hover:text-slate-800 transition-colors text-xl leading-none">✕</button>
                    </div>
                  </div>
                  <div className="aspect-video bg-black">
                    <iframe
                      className="w-full h-full"
                      src={`https://www.youtube-nocookie.com/embed/${playerId}?autoplay=${autoplay ? '1' : '0'}&modestbranding=1&rel=0&playsinline=1`}
                      title="YouTube video player"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      allowFullScreen
                    />
                  </div>
                </div>
              </div>
            )}

            {showHelp && (
              <div className="fixed inset-0 z-40 flex items-center justify-center p-4 backdrop-blur-sm">
                <div className="absolute inset-0 bg-black/50" onClick={() => setShowHelp(false)} />
                <div className="relative z-10 w-full max-w-2xl rounded-xl bg-white shadow-2xl overflow-hidden">
                  <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200 bg-slate-50">
                    <span className="text-base font-semibold text-slate-800">Instruções de Uso</span>
                    <button onClick={() => setShowHelp(false)} className="text-slate-500 hover:text-slate-800 transition-colors text-xl leading-none">✕</button>
                  </div>
                  <div className="p-5 text-sm text-slate-700 space-y-3">
                    <p>Edite o array <code>SONGS</code> no topo desta página. Cada item contém <code>id</code>, <code>title</code>, <code>link</code>, <code>key</code>, e opcionalmente <code>tags</code> e <code>chorus</code>.</p>
                    <p>Utilize a busca por título ou tags, e a ordenação por data. Clique em <em>Play</em> para assistir no YouTube ou <em>Abrir no YouTube</em> para acessar diretamente.</p>
                    <p>Os botões de <em>Exportar CSV</em> permitem baixar todas as músicas ou apenas as filtradas.</p>
                    <p><strong>Publicação:</strong> Este é um arquivo estático (não usa backend). Basta fazer upload para serviços como GitHub Pages, Vercel ou Netlify.</p>
                  </div>
                </div>
              </div>
            )}

            {showSchedule && (
              <div className="fixed inset-0 z-40 flex items-center justify-center p-4 backdrop-blur-sm">
                <div className="absolute inset-0 bg-black/50" onClick={() => setShowSchedule(false)} />
                <div className="relative z-10 w-full max-w-2xl rounded-xl bg-white shadow-2xl overflow-hidden">
                  <div className="flex items-center justify-between px-4 py-3 border-b border-slate-200 bg-slate-50">
                    <span className="text-base font-semibold text-slate-800">Escala de Ministros</span>
                    <button onClick={() => setShowSchedule(false)} className="text-slate-500 hover:text-slate-800 transition-colors text-xl leading-none">✕</button>
                  </div>
                  <div className="p-5 text-sm text-slate-700 space-y-2">
                    <ul className="list-disc list-inside">
                      {PRAISE_SCHEDULE.map((item, index) => (
                        <li key={index}>{item}</li>
                      ))}
                    </ul>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<AtriumPraise_Static_Viewer />);
    </script>
  </body>
  </html>


